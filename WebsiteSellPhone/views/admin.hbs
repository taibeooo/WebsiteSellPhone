{{ header }}

<!DOCTYPE html>
<html lang="vi">
  <head>
    <!-- Các thẻ meta bắt buộc -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Star Admin2</title>
    <!-- plugins:css -->
    <link rel="stylesheet" href="/public/assets/vendors/feather/feather.css">
    <link rel="stylesheet" href="/public/assets/vendors/mdi/css/materialdesignicons.min.css">
    <link rel="stylesheet" href="/public/assets/vendors/ti-icons/css/themify-icons.css">
    <link rel="stylesheet" href="/public/assets/vendors/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/public/assets/vendors/typicons/typicons.css">
    <link rel="stylesheet" href="/public/assets/vendors/simple-line-icons/css/simple-line-icons.css">
    <link rel="stylesheet" href="/public/assets/css/vendor.bundle.base.css">
    <link rel="stylesheet" href="/public/assets/css/bootstrap-datepicker.min.css">
    <!-- endinject -->
    <!-- Plugin css cho trang này -->
    <link rel="stylesheet" href="/public/assets/css/dataTables.bootstrap4.css">
    <link rel="stylesheet" href="/public/assets/css/select.dataTables.min.css">
    <!-- Kết thúc plugin css cho trang này -->
    <!-- inject:css -->
    <link rel="stylesheet" href="/public/assets/css/style.css">
    <!-- endinject -->
    <link rel="shortcut icon" href="/public/assets/images/favicon.png" />
    <style>
        canvas {
            max-width: 1000px; /* Tăng chiều rộng tối đa của biểu đồ */
            max-height: 500px; /* Tăng chiều cao tối đa của biểu đồ */
            width: 100%; /* Đặt chiều rộng của canvas thành 100% */
            height: auto; /* Chiều cao tự động để giữ tỷ lệ */
            margin: 20px auto; /* Giữ khoảng cách xung quanh canvas */
        }
      /* Định dạng cho bảng báo cáo hôm nay */
      .main-panel {
          padding: 20px; /* Đệm cho phần chính */
      }

      .content-wrapper {
          background-color: #fff; /* Màu nền trắng */
          border-radius: 5px; /* Bo góc */
          box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1); /* Đổ bóng nhẹ */
          padding: 20px; /* Đệm cho phần bên trong */
      }

      /* Định dạng cho hàng tiêu đề báo cáo hôm nay */
      .row h3 {
          margin-bottom: 20px; /* Khoảng cách dưới tiêu đề */
      }

      /* Định dạng cho hàng chứa các mục tổng doanh thu */
      .row {
          display: flex; /* Sử dụng Flexbox */
          justify-content: space-between; /* Căn chỉnh đều giữa các mục */
          margin-bottom: 20px; /* Khoảng cách dưới hàng */
      }

      /* Định dạng cho từng mục tổng doanh thu */
      .total-revenue-item {
          background-color: #f9f9f9; /* Màu nền nhẹ */
          border: 1px solid #ddd; /* Đường viền mỏng */
          border-radius: 5px; /* Bo góc */
          padding: 15px; /* Đệm cho phần bên trong */
          flex: 1; /* Để các mục có độ rộng bằng nhau */
          margin-right: 10px; /* Khoảng cách bên phải cho mỗi mục */
      }

      /* Loại bỏ khoảng cách bên phải cho mục cuối cùng */
      .total-revenue-item:last-child {
          margin-right: 0; /* Không có khoảng cách bên phải cho mục cuối cùng */
      }

      /* Định dạng tiêu đề báo cáo hôm nay */
      .total-revenue-item h5 {
          color: #333; /* Màu chữ */
          margin: 0; /* Không có khoảng cách cho tiêu đề */
      }

      /* Định dạng cho phần chứa báo cáo tùy chỉnh và theo quý */
      .report-custom, .report-quarterly {
          background-color: #f9f9f9; /* Màu nền nhẹ */
          border: 1px solid #ddd; /* Đường viền mỏng */
          border-radius: 5px; /* Bo góc */
          padding: 15px; /* Đệm cho phần bên trong */
          margin-bottom: 20px; /* Khoảng cách dưới mỗi phần */
      }

      .report-custom h5, .report-quarterly h5 {
          color: #333; /* Màu chữ */
          margin-bottom: 10px; /* Khoảng cách dưới tiêu đề */
      }

      /* Định dạng cho form */
      form {
          display: flex;
          flex-direction: column; /* Xếp chồng các phần tử lên nhau */
      }

      /* Định dạng cho các input */
      input[type="date"], select {
          padding: 10px; /* Đệm cho input */
          margin-bottom: 10px; /* Khoảng cách dưới input */
          border: 1px solid #ccc; /* Đường viền */
          border-radius: 4px; /* Bo góc */
      }

      /* Định dạng cho button */
      button {
          padding: 10px 15px; /* Đệm cho button */
          background-color: #28a745; /* Màu nền xanh */
          color: white; /* Màu chữ */
          border: none; /* Không có đường viền */
          border-radius: 4px; /* Bo góc */
          cursor: pointer; /* Con trỏ chuột thay đổi */
          transition: background-color 0.3s; /* Hiệu ứng chuyển đổi màu nền */
      }

      /* Hiệu ứng hover cho button */
      button:hover {
          background-color: #218838; /* Màu nền khi hover */
      }

      /* Định dạng cho phần chứa kết quả báo cáo */
      #report-results {
          margin-top: 20px; /* Khoảng cách trên */
      }

      /* Định dạng cho từng báo cáo hiển thị */
      #report-results div {
          background-color: #e9ecef; /* Màu nền nhẹ cho báo cáo */
          border: 1px solid #ccc; /* Đường viền */
          border-radius: 5px; /* Bo góc */
          padding: 10px; /* Đệm cho phần bên trong */
          margin-bottom: 15px; /* Khoảng cách giữa các báo cáo */
      }

      /* Định dạng tiêu đề báo cáo */
      #report-results h5 {
          margin: 5px 0; /* Khoảng cách cho tiêu đề báo cáo */
      }
    </style>
  </head>
  <body class="with-welcome-text">
    <div class="container-scroller">
      <!-- partial:partials/_navbar.html -->
      <nav class="navbar default-layout col-lg-12 col-12 p-0 fixed-top d-flex align-items-top flex-row">
        <div class="text-center navbar-brand-wrapper d-flex align-items-center justify-content-start">
          <div class="me-3">
            <button class="navbar-toggler navbar-toggler align-self-center" type="button" data-bs-toggle="minimize">
              <span class="icon-menu"></span>
            </button>
          </div>
          <div>
            <a class="navbar-brand brand-logo" href="/">
              <img src="/public/assets/images/logo.svg" alt="logo" />
            </a>
            <a class="navbar-brand brand-logo-mini" href="/">
              <img src="/public/assets/images/logo-mini.svg" alt="logo" />
            </a>
          </div>
        </div>
        <div class="navbar-menu-wrapper d-flex align-items-top">
          <ul class="navbar-nav">
            <li class="nav-item fw-semibold d-none d-lg-block ms-0">
              <h1 class="welcome-text">
                  <span class="text-black fw-bold">Welcome, {{admin.fullname}}!</span>
              </h1>
            </li>
          </ul>
          <ul class="navbar-nav ms-auto">

            <li class="nav-item dropdown d-none d-lg-block user-dropdown">
              <a class="nav-link" id="UserDropdown" href="/logout" data-bs-toggle="dropdown" aria-expanded="false">
                  {{!-- ảnh avt admin --}}
                  <button class="btn-primary" style="border-radius: 8px">Đăng xuất</button>
              </a>
              
            </li>
          </ul>
        </div>
      </nav>
      <!-- partial -->
      <div class="container-fluid page-body-wrapper">
        <!-- partial:partials/_sidebar.html -->
        <nav class="sidebar sidebar-offcanvas" id="sidebar">
          <ul class="nav">
            <li class="nav-item">
              <a class="nav-link" href="/admin">
                <i class="mdi mdi-grid-large menu-icon"></i>
                <span class="menu-title">Dashboard</span>
              </a>
            </li>
            <li class="nav-item nav-category">Quản lý Shop</li>
            <li class="nav-item">
              <a class="nav-link" data-bs-toggle="collapse" href="/employees" aria-expanded="false" aria-controls="ui-basic">
                <i class="menu-icon mdi mdi-floor-plan"></i>
                <span class="menu-title">Quản lý tài khoản</span>
                <i class="menu-arrow"></i>
              </a>
              <div class="collapse" id="ui-basic">
                <ul class="nav flex-column sub-menu">
                  <li class="nav-item"> <a class="nav-link" href="pages/ui-features/buttons.html">Buttons</a></li>
                  <li class="nav-item"> <a class="nav-link" href="pages/ui-features/dropdowns.html">Dropdowns</a></li>
                  <li class="nav-item"> <a class="nav-link" href="pages/ui-features/typography.html">Typography</a></li>
                </ul>
              </div>
            </li>
            <li class="nav-item">
              <a class="nav-link" data-bs-toggle="collapse" href="/admin/customer" aria-expanded="false" aria-controls="form-elements">
                <i class="menu-icon mdi mdi-card-text-outline"></i>
                <span class="menu-title">Quản lý khách hàng</span>
                <i class="menu-arrow"></i>
              </a>
              <div class="collapse" id="form-elements">
                <ul class="nav flex-column sub-menu">
                  <li class="nav-item"><a class="nav-link" href="pages/forms/basic_elements.html">Basic Elements</a></li>
                </ul>
              </div>
            </li>
            <li class="nav-item">
              <a class="nav-link" data-bs-toggle="collapse" href="/products" aria-expanded="false" aria-controls="charts">
                <i class="menu-icon mdi mdi-chart-line"></i>
                <span class="menu-title">Quản lý sản phẩm</span>
                <i class="menu-arrow"></i>
              </a>
              <div class="collapse" id="charts">
                <ul class="nav flex-column sub-menu">
                  <li class="nav-item"> <a class="nav-link" href="pages/charts/chartjs.html">ChartJs</a></li>
                </ul>
              </div>
            </li>
            <li class="nav-item">
              <a class="nav-link" data-bs-toggle="collapse" href="/admin/invoices" aria-expanded="false" aria-controls="tables">
                <i class="menu-icon mdi mdi-table"></i>
                <span class="menu-title">Quản lý hóa đơn</span>
                <i class="menu-arrow"></i>
              </a>
              <div class="collapse" id="tables">
                <ul class="nav flex-column sub-menu">
                  <li class="nav-item"> <a class="nav-link" href="pages/tables/basic-table.html">Basic table</a></li>
                </ul>
              </div>
            </li>
            <li class="nav-item">
              <a class="nav-link" data-bs-toggle="collapse" href="#icons" aria-expanded="false" aria-controls="icons">
                <i class="menu-icon mdi mdi-layers-outline"></i>
                <span class="menu-title">Quản lý sản phẩm sale</span>
                <i class="menu-arrow"></i>
              </a>
              <div class="collapse" id="icons">
                <ul class="nav flex-column sub-menu">
                  <li class="nav-item"> <a class="nav-link" href="pages/icons/font-awesome.html">Font Awesome</a></li>
                </ul>
              </div>
            </li>
          </ul>
        </nav>
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

            <div class="main-panel">
              <div class="content-wrapper">
                <div class="row">
                    <h2>Biểu Đồ Doanh Thu</h2>
                    <canvas id="revenueChart"></canvas>

                    <script>
                        const ctx = document.getElementById('revenueChart').getContext('2d');

                        // Nhận dữ liệu từ backend
                        const months = [{{#each months}}'{{this}}'{{#unless @last}},{{/unless}}{{/each}}]; // Dữ liệu tháng
                        const revenues = [{{#each revenues}}{{this}}{{#unless @last}},{{/unless}}{{/each}}]; // Dữ liệu doanh thu

                        const revenueChart = new Chart(ctx, {
                            type: 'bar', // loại biểu đồ là cột
                            data: {
                                labels: months, // tháng
                                datasets: [{
                                    label: 'Doanh thu (triệu VNĐ)',
                                    data: revenues.map(revenue => revenue / 1000000), // Chia doanh thu để hiển thị theo triệu
                                    backgroundColor: 'rgba(75, 192, 192, 0.6)', // màu nền cột
                                    borderColor: 'rgba(75, 192, 192, 1)', // màu viền cột
                                    borderWidth: 1 // độ dày viền cột
                                }]
                            },
                            options: {
                                scales: {
                                    y: {
                                        beginAtZero: true,
                                        min: 0, // Giá trị tối thiểu trên trục Y
                                        max: 250, // Giá trị tối đa trên trục Y (ví dụ 250 triệu VNĐ)
                                        ticks: {
                                            stepSize: 25, // khoảng cách giữa các tick là 25 triệu VNĐ
                                            callback: function(value) {
                                                return value + ' triệu'; // Hiển thị giá trị theo triệu
                                            }
                                        }
                                    }
                                },
                                responsive: true,
                                plugins: {
                                    legend: {
                                        display: true,
                                        position: 'top'
                                    },
                                    title: {
                                        display: true,
                                        text: 'Doanh thu theo tháng'
                                    }
                                }
                            }
                        });
                    </script>

                </div>
                <div class="row">
                  <h2>Top 10 Khách Hàng Chi Tiêu Nhiều Nhất</h2>
                    <table class="table table-bordered">
                        <thead>
                            <tr>
                                <th>STT</th>
                                <th>Tên khách hàng</th>
                                <th>Số điện thoại</th>
                                <th>Tổng chi tiêu</th>
                            </tr>
                        </thead>
                        <tbody>
                            {{#each top10Customers}}
                            <tr>
                                <td>{{add @index 1}}</td>
                                <td>{{this.customer.fullname}}</td>
                                <td>{{this.customer.phone}}</td>
                                <td>{{this.totalSpent}}</td>
                            </tr>
                            {{/each}}
                        </tbody>
                    </table>
                </div>
              </div>
            </div>
            <div class="main-panel">
              <div class="content-wrapper">    
                  <div class="row">
                      <h3>Báo cáo hôm nay</h3>
                  </div>
                  <div class="row">
                      <table class="table table-bordered">
                        <thead>
                          <tr>
                            <th>Chỉ tiêu</th>
                            <th>Số tiền</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr>
                            <td><strong>Tổng doanh thu</strong></td>
                            <td>
                              <script>
                              document.write((function(num) {
                                                return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, '.') + ' ₫';
                               })({{totalRevenue}}));
                              </script>
                            </td>
                          </tr>
                          <tr>
                            <td><strong>Tổng tiền nhập</strong></td>
                            <td>
                              <script>
                              document.write((function(num) {
                                                return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, '.') + ' ₫';
                               })({{totalImportPrice}}));
                              </script>
                            </td>
                          </tr>
                          <tr>
                            <td><strong>Lợi nhuận</strong></td>
                            <td>
                              <script>
                              document.write((function(num) {
                                                return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, '.') + ' ₫';
                               })({{profit}}));
                              </script>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                  </div>
                  <div class="row">
                      <div class="report-custom">
                          <h5>Xem báo cáo tùy chỉnh</h5>
                          <form id="custom-report-form" action="/admin/monthreport" method="GET"> <!-- Đổi phương thức thành GET -->
                              <input type="date" name="startDate" required>
                              <input type="date" name="endDate" required>
                              <button type="submit">Xem báo cáo</button>
                          </form>
                      </div>
                      <div class="report-quarterly">
                          <h5>Xem báo cáo theo quý</h5>
                          <form id="quarterly-report-form" action="/admin/quarterlyreport" method="GET"> <!-- Đổi phương thức thành GET -->
                              <select name="quarter" required>
                                  <option value="1">Quý 1</option>
                                  <option value="2">Quý 2</option>
                                  <option value="3">Quý 3</option>
                                  <option value="4">Quý 4</option>
                              </select>
                              <select name="year" required>
                                  <option value="2024">2024</option>
                                  <option value="2023">2023</option>
                                  <option value="2022">2022</option>
                                  <!-- Thêm năm khác nếu cần -->
                              </select>
                              <button type="submit">Xem báo cáo</button>
                          </form>
                      </div>
                  </div>
                  <div id="report-results"></div>
              </div>
            </div>
          <script>
            document.getElementById('custom-report-form').addEventListener('submit', function(event) {
                event.preventDefault(); // Ngăn chặn reload trang

                const formData = new FormData(this); // Lấy dữ liệu từ form

                fetch('/admin/monthreport?' + new URLSearchParams(formData), {
                    method: 'GET'
                })
                .then(response => response.json())
                .then(data => {
                    const reportContainer = document.getElementById('report-results');
                    reportContainer.innerHTML = ''; // Xóa nội dung cũ
                    const newReport = document.createElement('div'); // Tạo một div mới cho bảng báo cáo
                    newReport.innerHTML = `
                        <h5>Báo cáo doanh thu tuỳ chỉnh</h5>
                        <h5>Tổng doanh thu: ${data.totalRevenue} ₫</h5>
                        <h5>Tổng tiền nhập: ${data.totalImportPrice} ₫</h5>
                        <h5>Lợi nhuận: ${data.profit} ₫</h5>`; // Thêm dữ liệu báo cáo vào div mới
                    reportContainer.appendChild(newReport); // Thêm div mới vào phần chứa báo cáo
                })
                .catch(error => console.error('Lỗi:', error));
            });

            document.getElementById('quarterly-report-form').addEventListener('submit', function(event) {
                event.preventDefault(); // Ngăn chặn reload trang

                const formData = new FormData(this); // Lấy dữ liệu từ form

                fetch('/admin/quarterlyreport?' + new URLSearchParams(formData), {
                    method: 'GET'
                })
                .then(response => response.json())
                .then(data => {
                    const reportContainer = document.getElementById('report-results');
                    reportContainer.innerHTML = ''; // Xóa nội dung cũ
                    const newReport = document.createElement('div'); // Tạo một div mới cho bảng báo cáo
                    newReport.innerHTML = `
                        <h5>Báo cáo doanh thu theo quý</h5>
                        <h5>Tổng doanh thu: ${data.totalRevenue} ₫</h5>
                        <h5>Tổng tiền nhập: ${data.totalImportPrice} ₫</h5>
                        <h5>Lợi nhuận: ${data.profit} ₫</h5>`; // Thêm dữ liệu báo cáo vào div mới
                    reportContainer.appendChild(newReport); // Thêm div mới vào phần chứa báo cáo
                })
                .catch(error => console.error('Lỗi:', error));
            });
            
          </script>
      </div>
    </div>
    
    <!-- container-scroller -->
    <!-- plugins:js -->
    <script src="assets/vendors/js/vendor.bundle.base.js"></script>
    <script src="assets/vendors/bootstrap-datepicker/bootstrap-datepicker.min.js"></script>
    <!-- endinject -->
    <!-- Plugin js for this page -->
    <script src="assets/vendors/chart.js/chart.umd.js"></script>
    <script src="assets/vendors/progressbar.js/progressbar.min.js"></script>
    <!-- End plugin js for this page -->
    <!-- inject:js -->
    <script src="assets/js/off-canvas.js"></script>
    <script src="assets/js/template.js"></script>
    <script src="assets/js/settings.js"></script>
    <script src="assets/js/hoverable-collapse.js"></script>
    <script src="assets/js/todolist.js"></script>
    <!-- endinject -->
    <!-- Custom js for this page-->
    <script src="assets/js/jquery.cookie.js" type="text/javascript"></script>
    <script src="assets/js/dashboard.js"></script>
    <!-- <script src="assets/js/Chart.roundedBarCharts.js"></script> -->
    <!-- End custom js for this page-->
  </body>
</html>

{{ footer }}
